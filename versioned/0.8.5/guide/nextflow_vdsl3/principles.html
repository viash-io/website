<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Viash - VDSL3 principles</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../guide/nextflow_vdsl3/create-and-use-a-module.html" rel="next">
<link href="../../guide/nextflow_vdsl3/index.html" rel="prev">
<link href="../../favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-GDS2XT0DDG"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-GDS2XT0DDG', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Viash - VDSL3 principles">
<meta property="og:description" content="">
<meta property="og:image" content="https://viash.io/guide/nextflow_vdsl3/viash.png">
<meta property="og:site_name" content="Viash">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../viash.png" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Overview</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../installation/index.html"> 
<span class="menu-text">Installation</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../quickstart/index.qmd"> 
<span class="menu-text">Quickstart</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../../guide/index.html" aria-current="page"> 
<span class="menu-text">Guide</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../reference/index.html"> 
<span class="menu-text">Reference</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-help" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Help</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-help">    
        <li>
    <a class="dropdown-item" href="https://github.com/viash-io/viash/issues"><i class="bi bi-bug" role="img">
</i> 
 <span class="dropdown-text">Report a Viash issue</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/viash-io/website/issues"><i class="bi bi-bug" role="img">
</i> 
 <span class="dropdown-text">Report a website issue</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../cheatsheet/viash_cheatsheet_v1_1.pdf"><i class="bi bi-card-list" role="img">
</i> 
 <span class="dropdown-text">Cheat sheet</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/viash-io/viash"> <i class="bi bi-github" role="img" aria-label="Viash GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../guide/index.html">Guide</a></li><li class="breadcrumb-item"><a href="../../guide/nextflow_vdsl3/index.html">Nextflow VDSL3</a></li><li class="breadcrumb-item"><a href="../../guide/nextflow_vdsl3/principles.html">VDSL3 principles</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Guide</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../guide/component/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Component</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guide/component/create-component.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Create a new component</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guide/component/add-dependencies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Add dependencies</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guide/component/add-resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Add resources</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guide/component/use-helper-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Use helper functions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guide/component/variables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Par and meta variables</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guide/component/unit-testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Unit testing</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../guide/project/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Project</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guide/project/structure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Structure</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guide/project/batch-processing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Batch processing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guide/project/project-config.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Project config</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guide/project/ide-setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">IDE setup</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../guide/nextflow_vdsl3/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Nextflow VDSL3</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guide/nextflow_vdsl3/principles.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">VDSL3 principles</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guide/nextflow_vdsl3/create-and-use-a-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Create and use a module</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guide/nextflow_vdsl3/create-a-pipeline.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Create a pipeline</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#quick-recap" id="toc-quick-recap" class="nav-link active" data-scroll-target="#quick-recap">Quick recap</a>
  <ul class="collapse">
  <li><a href="#nextflow-channel" id="toc-nextflow-channel" class="nav-link" data-scroll-target="#nextflow-channel">Nextflow channel</a></li>
  <li><a href="#functional-reactive-programming-frp" id="toc-functional-reactive-programming-frp" class="nav-link" data-scroll-target="#functional-reactive-programming-frp">Functional Reactive Programming (FRP)</a></li>
  </ul></li>
  <li><a href="#a-critique-on-channels-or-is-it" id="toc-a-critique-on-channels-or-is-it" class="nav-link" data-scroll-target="#a-critique-on-channels-or-is-it">A critique on channels, or is it?</a>
  <ul class="collapse">
  <li><a href="#illustration-by-means-of-an-nf-core-pipeline" id="toc-illustration-by-means-of-an-nf-core-pipeline" class="nav-link" data-scroll-target="#illustration-by-means-of-an-nf-core-pipeline">Illustration by means of an nf-core pipeline</a></li>
  <li><a href="#pain-points" id="toc-pain-points" class="nav-link" data-scroll-target="#pain-points">Pain points</a></li>
  <li><a href="#consequences" id="toc-consequences" class="nav-link" data-scroll-target="#consequences">Consequences</a></li>
  <li><a href="#catch-22" id="toc-catch-22" class="nav-link" data-scroll-target="#catch-22">Catch-22</a></li>
  <li><a href="#viash-to-the-rescue" id="toc-viash-to-the-rescue" class="nav-link" data-scroll-target="#viash-to-the-rescue">Viash to the rescue</a></li>
  </ul></li>
  <li><a href="#vdsl3-module-interface" id="toc-vdsl3-module-interface" class="nav-link" data-scroll-target="#vdsl3-module-interface">VDSL3 module interface</a></li>
  <li><a href="#customizing-vdsl3-modules-on-the-fly" id="toc-customizing-vdsl3-modules-on-the-fly" class="nav-link" data-scroll-target="#customizing-vdsl3-modules-on-the-fly">Customizing VDSL3 modules on the fly</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/viash-io/website/edit/main/guide/nextflow_vdsl3/principles.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/viash-io/website/blob/main/guide/nextflow_vdsl3/principles.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/viash-io/website/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../guide/index.html">Guide</a></li><li class="breadcrumb-item"><a href="../../guide/nextflow_vdsl3/index.html">Nextflow VDSL3</a></li><li class="breadcrumb-item"><a href="../../guide/nextflow_vdsl3/principles.html">VDSL3 principles</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">VDSL3 principles</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This section assumes knowledge of how to create and manipulate Nextflow channels using DSL2. For more information, check out the <a href="https://www.nextflow.io/docs/latest/index.html">Nextflow reference docs</a> or contact <a href="https://www.data-intuitive.com/contact">Data Intuitive</a> for a complete Nextflow+Viash course.</p>
</div>
</div>
<section id="quick-recap" class="level2">
<h2 class="anchored" data-anchor-id="quick-recap">Quick recap</h2>
<section id="nextflow-channel" class="level3">
<h3 class="anchored" data-anchor-id="nextflow-channel">Nextflow channel</h3>
<p>A Nextflow <a href="https://www.nextflow.io/docs/latest/channel.html#channels"><code>Channel</code></a> object (later referred to just as channel) is in fact an implementation of the <a href="https://en.wikipedia.org/wiki/Dataflow_programming">Dataflow Programming</a> model. Nextflow has added a a set of <a href="https://www.nextflow.io/docs/latest/operator.html#operators">operators</a> for manipulating channels (<code>filter</code>, <code>map</code>, <code>reduce</code>, …) so that it tends more to a <a href="#frp">Functional Reactive Programming</a> (FRP) model<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
</section>
<section id="functional-reactive-programming-frp" class="level3">
<h3 class="anchored" data-anchor-id="functional-reactive-programming-frp">Functional Reactive Programming (FRP)</h3>
<p>If you’re new to FRP, here is a a list of pointers that will get you started:</p>
<ul>
<li>An excellent <a href="https://itnext.io/demystifying-functional-reactive-programming-67767dbe520b">Medium post</a> from Timo Stöttner</li>
<li>The <a href="https://gist.github.com/staltz/868e7e9bc2a7b8c1f754">introduction</a> to Reactive Programming you’ve been missing from André Staltz.</li>
<li>A very insightful <a href="https://www.youtube.com/watch?v=fdol03pcvMA">presentation</a> by Staltz where he introduces FRP from first principles (with live coding).</li>
</ul>
<p>In what follows, we will refer to channels and <em>streams</em> in line with those authors but if you’re used to working with <a href="http://reactivex.io/">Rx</a> you would call this an observable.</p>
<p>Using the FRP model for describing data processing workflows is not new, other initiatives have recognized that FRP is a good fit for pipeline development:</p>
<ul>
<li><a href="https://soft.vub.ac.be/~mathsaey/skitter/">Skitter</a></li>
<li><a href="https://github.com/weng-lab/krews">Krews</a></li>
</ul>
</section>
</section>
<section id="a-critique-on-channels-or-is-it" class="level2">
<h2 class="anchored" data-anchor-id="a-critique-on-channels-or-is-it">A critique on channels, or is it?</h2>
<section id="illustration-by-means-of-an-nf-core-pipeline" class="level3">
<h3 class="anchored" data-anchor-id="illustration-by-means-of-an-nf-core-pipeline">Illustration by means of an nf-core pipeline</h3>
<p>Let us start with an illustration of where Nextflow’s implementation (and how people use it) lacks some necessary features. We start by taking a look at <a href="https://github.com/nf-core/rnaseq/blob/b89fac32650aacc86fcda9ee77e00612a1d77066/subworkflows/local/align_star/main.nf#L36">one line</a> from one of the most active <a href="https://github.com/nf-core/rnaseq">nf-core</a> pipelines, namely <a href="https://github.com/nf-core">nf-core/rnaseq</a>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode groovy code-with-copy"><code class="sourceCode groovy"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">STAR_ALIGN_IGENOMES</span> <span class="op">(</span> reads<span class="op">,</span> index<span class="op">,</span> gtf<span class="op">,</span> star_ignore_sjdbgtf<span class="op">,</span> seq_platform<span class="op">,</span> seq_center <span class="op">)</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This calls a Nextflow process to align the <code>reads</code> according to a reference <code>index</code> and some other (optional) ‘values’. That is, those are not really all values. As the <a href="https://github.com/nf-core/rnaseq/blob/b89fac32650aacc86fcda9ee77e00612a1d77066/subworkflows/local/align_star/main.nf#L36">calling <code>worklow</code></a> indicates:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode groovy code-with-copy"><code class="sourceCode groovy"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>workflow ALIGN_STAR <span class="op">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    take<span class="op">:</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    reads               <span class="co">// channel: [ val(meta), [ reads ] ]</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    index               <span class="co">// channel: [ val(meta), [ index ] ]</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    gtf                 <span class="co">// channel: [ val(meta), [ gtf ] ]</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    star_ignore_sjdbgtf <span class="co">// boolean: when using pre-built STAR indices do not re-extract and use splice junctions from the GTF file </span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    seq_platform        <span class="co">// string : sequencing platform</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    seq_center          <span class="co">// string : sequencing center</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    is_aws_igenome      <span class="co">// boolean: whether the genome files are from AWS iGenomes</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    fasta               <span class="co">// channel: /path/to/fasta</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Luckily, if a plain value rather than a channel is passed to a <code>process</code> it is automatically converted to a channel. Since <code>reads</code> can have a multiplicity larger than one (one usually employs data pipelines because of their ability to process multiple samples in parallel), also the plain values are duplicated so all these inputs end up being channels with the same amount of items or events in them.</p>
<p>A similar issue relates to the <code>index</code> or genome reference: the pipeline allows the user to specify a genome reference (<code>params.star_index</code>) to be used for all samples. Also here, Nextflow will notice that multiple items in the <code>reads</code> channel need to be combined with 1 item in the <code>index</code> channel and will therefore automatically duplicate the <code>index</code> channel item as many times as necessary.</p>
<p>That’s a lot of magic going one, which in itself is not an issue. It becomes an issue, for instance, if we consider for instance that different samples (<code>reads</code>) would require different genome references (<code>index</code>).</p>
</section>
<section id="pain-points" class="level3">
<h3 class="anchored" data-anchor-id="pain-points">Pain points</h3>
<section id="per-sample-settings" class="level4">
<h4 class="anchored" data-anchor-id="per-sample-settings">Per-sample settings</h4>
<p>As illustrated above, a per-sample genome reference would not be possible in the way the <a href="https://github.com/nf-core">nf-core/rnaseq</a> pipeline is currently implemented. In fact, it would involve a lot of extra code to make it possible in the way the channels are used.</p>
<p>Let us create a toy example to illustrate this conceptually:</p>
<p>We start from a channel with 3 items: <code>1</code>, <code>2</code> and <code>3</code>. We create a second channel where these values are multiplied by 10 (making use of some of the Nextflow channel magic described earlier) and add both channels.</p>
<p>Think about what you would expect to come out and then verify the result below.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode groovy code-with-copy"><code class="sourceCode groovy"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>process add <span class="op">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  input<span class="op">:</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">val</span><span class="op">(</span>input1<span class="op">)</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">val</span><span class="op">(</span>input2<span class="op">)</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  output<span class="op">:</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">val</span><span class="op">(</span>output<span class="op">)</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  exec<span class="op">:</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    output <span class="op">=</span> input1 <span class="op">+</span> input2</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>process times <span class="op">{</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  input<span class="op">:</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">val</span><span class="op">(</span>input1<span class="op">)</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">val</span><span class="op">(</span>input2<span class="op">)</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  output<span class="op">:</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">val</span><span class="op">(</span>output<span class="op">)</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  exec<span class="op">:</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    output <span class="op">=</span> input1 <span class="op">*</span> input2</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  ch1 <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">from</span><span class="op">(</span> <span class="op">[</span> <span class="dv">1</span><span class="op">,</span>  <span class="dv">2</span><span class="op">,</span>  <span class="dv">3</span> <span class="op">]</span> <span class="op">)</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  ch2 <span class="op">=</span> <span class="fu">times</span><span class="op">(</span>ch1<span class="op">,</span> <span class="dv">10</span><span class="op">)</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add</span><span class="op">(</span>ch1<span class="op">,</span> ch2<span class="op">)</span> <span class="op">|</span> view</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<details>
<summary>
Output
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">nextflow</span> run conventional.nf <span class="at">-ansi-log</span> false</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>N E X T F L O W  ~  version 23.04.1
Launching `conventional.nf` [sick_allen] DSL2 - revision: 4111eb632c
[43/7890cb] Submitted process &gt; times (3)
[ad/75b82a] Submitted process &gt; times (1)
[25/57a1ad] Submitted process &gt; times (2)
[57/29ee3d] Submitted process &gt; add (1)
[80/9bc295] Submitted process &gt; add (2)
31
[bf/9f4234] Submitted process &gt; add (3)
12
23</code></pre>
</div>
</div>
</details>
<p>This document is auto-generated and may as a result (once in 3 times) return three numbers <code>11</code>, <code>22</code> and <code>33</code>. But it may as well return <code>21</code>, <code>32</code> and <code>13</code>. The reason is simple: channels are asynchronous by design and order is therefore not guaranteed.</p>
<p>This has huge consequences for keeping track of the flow of data through the pipeline. As a result, one will often see channels contain not only <em>data</em> but also an identifier (ID) in the form of a tuple: <code>[&lt;ID&gt;, &lt;data&gt; ]</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode groovy code-with-copy"><code class="sourceCode groovy"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>process add <span class="op">{</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  input<span class="op">:</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    tuple <span class="fu">val</span><span class="op">(</span>id<span class="op">),</span> <span class="fu">val</span><span class="op">(</span>input1<span class="op">),</span> <span class="fu">val</span><span class="op">(</span>input2<span class="op">)</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  output<span class="op">:</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    tuple <span class="fu">val</span><span class="op">(</span>id<span class="op">),</span> <span class="fu">val</span><span class="op">(</span>output<span class="op">)</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  exec<span class="op">:</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    output <span class="op">=</span> input1 <span class="op">+</span> input2</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>process times <span class="op">{</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  input<span class="op">:</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    tuple <span class="fu">val</span><span class="op">(</span>id<span class="op">),</span> <span class="fu">val</span><span class="op">(</span>input<span class="op">)</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  output<span class="op">:</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    tuple <span class="fu">val</span><span class="op">(</span>id<span class="op">),</span> <span class="fu">val</span><span class="op">(</span>output<span class="op">)</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  exec<span class="op">:</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    output <span class="op">=</span> input <span class="op">*</span> <span class="dv">10</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  ch1 <span class="op">=</span> <span class="bu">Channel</span><span class="op">.</span><span class="fu">from</span><span class="op">(</span> <span class="op">[</span> <span class="op">[</span> <span class="st">"a"</span><span class="op">,</span> <span class="dv">1</span><span class="op">],</span> <span class="op">[</span> <span class="st">"b"</span><span class="op">,</span> <span class="dv">2</span><span class="op">],</span> <span class="op">[</span> <span class="st">"c"</span><span class="op">,</span> <span class="dv">3</span><span class="op">]</span> <span class="op">]</span> <span class="op">)</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  ch2 <span class="op">=</span> <span class="fu">times</span><span class="op">(</span>ch1<span class="op">)</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  ch1</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> <span class="fu">join</span><span class="op">(</span>ch2<span class="op">)</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> add</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> view</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>When we run this script, we get the following result:</p>
<details>
<summary>
Output
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">nextflow</span> run id.nf <span class="at">-ansi-log</span> false</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>N E X T F L O W  ~  version 23.04.1
Launching `id.nf` [trusting_hodgkin] DSL2 - revision: 6939fc5e2e
[7b/11fa78] Submitted process &gt; times (2)
[f3/9c6088] Submitted process &gt; times (1)
[bf/68422d] Submitted process &gt; times (3)
[e1/16d985] Submitted process &gt; add (1)
[57/cef4c8] Submitted process &gt; add (2)
[31/4c821e] Submitted process &gt; add (3)
[b, 22]
[a, 11]
[c, 33]</code></pre>
</div>
</div>
</details>
<p>This version does exactly what we want it to do, but please notice that both the API for <code>times</code> as well as <code>add</code> have changed! We can not simply keep juggling with channels if we expect them to be aligned at some point.</p>
<p>If we apply this to the Nextflow samples from the nf-core pipelines discussed earlier, we must conclude that only by add an ID consistently will we be able to make sure that we deal with the proper content of the channels.</p>
<p>Please note in our latest version that having both inputs for the <code>add</code> step in one channel event makes life much easier: we are sure both values correspond to the same ‘sample’ (i.e.&nbsp;have the same ID).</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>We need to pass an ID with the channel and thus at least have a tuple <code>[ id, &lt;data&gt; ]</code>.</p>
</div>
</div>
</section>
<section id="runtime-arguments" class="level4">
<h4 class="anchored" data-anchor-id="runtime-arguments">Runtime arguments</h4>
<p>Dealing with runtime arguments is an extension of the pre-sample issue discussed above: In our experience it occurs regularly that an argument of a step in the pipeline (say the cluster size for a filter) depends on:</p>
<ul>
<li>user input, similarly to the genome reference above but then dependent on the sample,</li>
<li>an earlier step in the pipeline that for instance has performed clustering.</li>
</ul>
<p>To make things worse, maybe the cluster size has a default value an the user <em>can</em> override it but does not necessarily have to.</p>
<p>There are in fact three difficulties here:</p>
<ol type="1">
<li>Storing the output of an ealier step so it can be picked up later</li>
<li>Connecting the proper argument to the correct sample</li>
<li>Making sure this argument is used for the proper step in the pipeline</li>
</ol>
<p>As argued above, doing (2) is nearly impossible in vanilla Nextflow and (1) is hard. The example of STAR alignment illustrates how (3) is performed: the ‘argument’ is added as an additional input (channel) to the step in the pipeline.</p>
<p>The following</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode groovy code-with-copy"><code class="sourceCode groovy"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>process add <span class="op">{</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  input<span class="op">:</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// This time, input is a hashmap containing .left and .right</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    tuple <span class="fu">val</span><span class="op">(</span>id<span class="op">),</span> <span class="fu">val</span><span class="op">(</span>input<span class="op">)</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  output<span class="op">:</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    tuple <span class="fu">val</span><span class="op">(</span>id<span class="op">),</span> <span class="fu">val</span><span class="op">(</span>output<span class="op">)</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  exec<span class="op">:</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    output <span class="op">=</span> input<span class="op">.</span>left <span class="op">+</span> input<span class="op">.</span>right</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>process times <span class="op">{</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  input<span class="op">:</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// This time, input is a hashmap containing .left and .right</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    tuple <span class="fu">val</span><span class="op">(</span>id<span class="op">),</span> <span class="fu">val</span><span class="op">(</span>input<span class="op">)</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  output<span class="op">:</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    tuple <span class="fu">val</span><span class="op">(</span>id<span class="op">),</span> <span class="fu">val</span><span class="op">(</span>output<span class="op">)</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  exec<span class="op">:</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    output <span class="op">=</span> input<span class="op">.</span>left <span class="op">*</span> input<span class="op">.</span>right</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  ch1 <span class="op">=</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Channel</span><span class="op">.</span><span class="fu">from</span><span class="op">(</span> <span class="op">[</span> <span class="op">[</span> <span class="st">"a"</span><span class="op">,</span> <span class="dv">1</span><span class="op">],</span> <span class="op">[</span> <span class="st">"b"</span><span class="op">,</span> <span class="dv">2</span><span class="op">],</span> <span class="op">[</span> <span class="st">"c"</span><span class="op">,</span> <span class="dv">3</span><span class="op">]</span> <span class="op">]</span> <span class="op">)</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>  ch2 <span class="op">=</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    ch1</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>      <span class="op">|</span> map<span class="op">{</span> id<span class="op">,</span> value <span class="op">-&gt;</span> <span class="op">[</span> id<span class="op">,</span> <span class="op">[</span> left<span class="op">:</span> value<span class="op">,</span> right<span class="op">:</span> params<span class="op">.</span>multiplier <span class="op">]</span> <span class="op">]</span> <span class="op">}</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>      <span class="op">|</span> times</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>  ch1</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> map<span class="op">{</span> id<span class="op">,</span> value <span class="op">-&gt;</span> <span class="op">[</span> id<span class="op">,</span> <span class="op">[</span> left<span class="op">:</span> value <span class="op">]</span> <span class="op">]</span> <span class="op">}</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> <span class="fu">join</span><span class="op">(</span> ch2 <span class="op">|</span> map<span class="op">{</span> id<span class="op">,</span> value <span class="op">-&gt;</span> <span class="op">[</span> id<span class="op">,</span> <span class="op">[</span> right<span class="op">:</span> value <span class="op">]</span> <span class="op">]</span> <span class="op">}</span> <span class="op">)</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> map<span class="op">{</span> id<span class="op">,</span> left<span class="op">,</span> right <span class="op">-&gt;</span> <span class="op">[</span> id<span class="op">,</span> left <span class="op">+</span> right <span class="op">]</span> <span class="op">}</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> add</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> view</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Please note that we add <code>map</code> operator to both channels in order to turn both input channels into a channel that contains either the <code>left</code> or the <code>right</code> key for them to be added in one more <code>map</code> operation using the <code>left + right</code> statement<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p>
<p>Also the <code>times</code> step is now extended to take into account input from the user at runtime as well. Remark that this is now very easily done.</p>
<p>When we run this script</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">nextflow</span> run hash.nf <span class="at">--multiplier</span> 20</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>we get the following result:</p>
<details>
<summary>
Output
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">nextflow</span> run hash.nf <span class="at">-ansi-log</span> false <span class="at">--multiplier</span> 20</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>N E X T F L O W  ~  version 23.04.1
Launching `hash.nf` [agitated_kare] DSL2 - revision: 15cf29e2fe
[84/5b3f23] Submitted process &gt; times (3)
[9d/3c0fe0] Submitted process &gt; times (2)
[f6/d57e5b] Submitted process &gt; times (1)
[71/552c1e] Submitted process &gt; add (1)
[e4/7413d7] Submitted process &gt; add (2)
[26/55caab] Submitted process &gt; add (3)
[c, 63]
[b, 42]
[a, 21]</code></pre>
</div>
</div>
</details>
<p>The second element of the tuple we refer to as the <em>state</em>. In general, it contains pointers to data, data files, arguments but it may also contains outputs from earlier steps or transcript information, etc.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>The second element of the tuple passed through the channel is called the <em>state</em> and contains all information we need or want to keep connected to the sample this tuple points to.</p>
</div>
</div>
<p>Since the <em>state</em> is part of the tuple, it is uniquely connected to the sample ID. In order to be able to pass the output from an earlier step as an argument to a later step, the output has to be a hashmap as well. The following update to the earlier script illustrates this:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode groovy code-with-copy"><code class="sourceCode groovy"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>process add <span class="op">{</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  input<span class="op">:</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// This time, input is a hashmap containing .left and .right</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    tuple <span class="fu">val</span><span class="op">(</span>id<span class="op">),</span> <span class="fu">val</span><span class="op">(</span>input<span class="op">)</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  output<span class="op">:</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    tuple <span class="fu">val</span><span class="op">(</span>id<span class="op">),</span> <span class="fu">val</span><span class="op">(</span>output<span class="op">)</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  exec<span class="op">:</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    output <span class="op">=</span> <span class="op">[</span> result<span class="op">:</span> input<span class="op">.</span>left <span class="op">+</span> input<span class="op">.</span>right<span class="op">,</span> left<span class="op">:</span> input<span class="op">.</span>left<span class="op">,</span> right<span class="op">:</span> input<span class="op">.</span>right <span class="op">]</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>process times <span class="op">{</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  input<span class="op">:</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// This time, input is a hashmap containing .left and .right</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    tuple <span class="fu">val</span><span class="op">(</span>id<span class="op">),</span> <span class="fu">val</span><span class="op">(</span>input<span class="op">)</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  output<span class="op">:</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    tuple <span class="fu">val</span><span class="op">(</span>id<span class="op">),</span> <span class="fu">val</span><span class="op">(</span>output<span class="op">)</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  exec<span class="op">:</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    output <span class="op">=</span> <span class="op">[</span> result<span class="op">:</span> input<span class="op">.</span>left <span class="op">*</span> input<span class="op">.</span>right<span class="op">,</span> left<span class="op">:</span> input<span class="op">.</span>left<span class="op">,</span> right<span class="op">:</span> input<span class="op">.</span>right <span class="op">]</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  ch1 <span class="op">=</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Channel</span><span class="op">.</span><span class="fu">from</span><span class="op">(</span> <span class="op">[</span> <span class="op">[</span> <span class="st">"a"</span><span class="op">,</span> <span class="dv">1</span><span class="op">],</span> <span class="op">[</span> <span class="st">"b"</span><span class="op">,</span> <span class="dv">2</span><span class="op">],</span> <span class="op">[</span> <span class="st">"c"</span><span class="op">,</span> <span class="dv">3</span><span class="op">]</span> <span class="op">]</span> <span class="op">)</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>  ch2 <span class="op">=</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    ch1</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>      <span class="op">|</span> map<span class="op">{</span> id<span class="op">,</span> value <span class="op">-&gt;</span> <span class="op">[</span> id<span class="op">,</span> <span class="op">[</span> left<span class="op">:</span> value<span class="op">,</span> right<span class="op">:</span> params<span class="op">.</span>multiplier <span class="op">]</span> <span class="op">]</span> <span class="op">}</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>      <span class="op">|</span> times</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>  ch1</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> map<span class="op">{</span> id<span class="op">,</span> value <span class="op">-&gt;</span> <span class="op">[</span> id<span class="op">,</span> <span class="op">[</span> left<span class="op">:</span> value <span class="op">]</span> <span class="op">]</span> <span class="op">}</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> <span class="fu">join</span><span class="op">(</span> ch2 <span class="op">|</span> map<span class="op">{</span> id<span class="op">,</span> times_output <span class="op">-&gt;</span> <span class="op">[</span> id<span class="op">,</span> <span class="op">[</span> right<span class="op">:</span> times_output<span class="op">.</span>result <span class="op">]</span> <span class="op">]</span> <span class="op">}</span> <span class="op">)</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> map<span class="op">{</span> id<span class="op">,</span> left_map<span class="op">,</span> right_map <span class="op">-&gt;</span> <span class="op">[</span> id<span class="op">,</span> left_map <span class="op">+</span> right_map <span class="op">]</span> <span class="op">}</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> add</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> view</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This result in:</p>
<details>
<summary>
Output
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">nextflow</span> run hash-output.nf <span class="at">-ansi-log</span> false <span class="at">--multiplier</span> 20</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>N E X T F L O W  ~  version 23.04.1
Launching `hash-output.nf` [loving_spence] DSL2 - revision: 43066cbd22
[ba/dc49ef] Submitted process &gt; times (2)
[e3/00f148] Submitted process &gt; times (3)
[79/bccd6f] Submitted process &gt; times (1)
[38/105602] Submitted process &gt; add (1)
[e4/a8422e] Submitted process &gt; add (2)
[4a/54d30f] Submitted process &gt; add (3)
[b, [result:42, left:2, right:40]]
[c, [result:63, left:3, right:60]]
[a, [result:21, left:1, right:20]]</code></pre>
</div>
</div>
</details>
</section>
</section>
<section id="consequences" class="level3">
<h3 class="anchored" data-anchor-id="consequences">Consequences</h3>
<p>The consequence of the above two major challenges when using vanilla Nextflow and their ideal solution is twofold, as illustated by the last example:</p>
<ol type="1">
<li>One has to write a lot of <code>map</code> operations to tie together every step, especially using hashmaps for the output as well may make the pipeline code hard to reason about.</li>
<li>The steps (<code>process</code> definitions) need to be aware of what can be expected to come in and what they should write out. Ideally, though, those should be simple wrappers for existing scripts that have been implemented earlier.</li>
</ol>
<p>For instance, imagine doing the above in R or Python, one would have to serialize the incoming hashmap into something readable in the script. That is probably beyond the scope of most researchers that deal with bioinformatics pipelines.</p>
</section>
<section id="catch-22" class="level3">
<h3 class="anchored" data-anchor-id="catch-22">Catch-22</h3>
<p>In a sense, given the above, we find ourselves in a catch-22. Either we use vanilla Nextflow and are stuck in an environment that allows for a lot of flexibility, just not enough for slightly more complex use-cases. Or we have to start adding a lot of extra code, both in the pipeline script itself as well as all individual components<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>.</p>
</section>
<section id="viash-to-the-rescue" class="level3">
<h3 class="anchored" data-anchor-id="viash-to-the-rescue">Viash to the rescue</h3>
<p>The challenges that remain when passing tuples of the form <code>[ id, state ]</code> through the channels in a pipeline can be resolved by adding some boilerplate to the individual steps in the pipeline. But of course, we don’t want to do that manually. Rather, we need to automate this so that it becomes testable and fault-tolerant.</p>
<p>That’s basically what Viash can do when building for the <code>platform: nextflow</code><a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>.</p>
</section>
</section>
<section id="vdsl3-module-interface" class="level2">
<h2 class="anchored" data-anchor-id="vdsl3-module-interface">VDSL3 module interface</h2>
<p>VDSL3 modules are actually workflows which take one channel and emit one channel. It expects the channel events to be tuples containing an ‘id’ and a ‘state’:</p>
<pre><code>[ id, state ]</code></pre>
<p>where <code>id</code> is a unique String and <code>state</code> is a <code>Map[String, Object]</code>. The resulting channel then consists of tuples <code>[id, new_state]</code>.</p>
<p><strong>Example:</strong></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode groovy code-with-copy"><code class="sourceCode groovy"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>workflow <span class="op">{</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">Channel</span><span class="op">.</span><span class="fu">fromList</span><span class="op">([</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="st">"myid"</span><span class="op">,</span> <span class="op">[</span>input<span class="op">:</span> <span class="fu">file</span><span class="op">(</span><span class="st">"in.txt"</span><span class="op">)]]</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">])</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> mymodule</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If the input tuple has more than two elements, the elements after the second element are passed through to the output tuple. That is, an input tuple <code>[id, input, ...]</code> will result in a tuple <code>[id, output, ...]</code> after running the module. For example, an input tuple <code>["foo", [input: file("in.txt")], "bar"]</code> will result in an output tuple <code>["foo", [output: file("out.txt")], "bar"]</code>.</p>
</div>
</div>
</section>
<section id="customizing-vdsl3-modules-on-the-fly" class="level2">
<h2 class="anchored" data-anchor-id="customizing-vdsl3-modules-on-the-fly">Customizing VDSL3 modules on the fly</h2>
<p>Usually, Nextflow processes are quite static objects. For example, changing its directives can be tricky. Per-sample settings are practically impossible to achieve with vanilla Nextflow.</p>
<p>The <code>run()</code> function is a unique feature for every VDSL3 module which allows dynamically altering the behaviour of a module from within the pipeline. For example, we use it to set the <code>publishDir</code> directive to <code>"output/"</code> so the output of that step in the pipeline will be stored as output.</p>
<p>See the <a href="../../reference/nextflow_vdsl3/import_module.html#customizing-vdsl3-modules-on-the-fly">reference documentation</a> for a complete list of arguments of <code>.run()</code>.</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Having said that, NextFlow allows one to mix functional and imperative programming to the point that a developer is able to shoot oneselve in the foot.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>In principle, we could return a similar hashmap from every step as well and even include the original input or logging information along with it!<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>In a sense, this is already the case. When taking a look at a typical <code>process</code> definition in the [nv-core/rnaseq] repository, a lot of boilerplate code has (manually) been added to make things work.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Other build platforms are available, as illustrated elsehwere in these pages.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script type="text/javascript">
// Anything in this script block will be included on every page
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/viash\.io");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../guide/nextflow_vdsl3/index.html" class="pagination-link  aria-label=" nextflow="" vdsl3"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Nextflow VDSL3</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../guide/nextflow_vdsl3/create-and-use-a-module.html" class="pagination-link" aria-label="Create and use a module">
        <span class="nav-page-text">Create and use a module</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../../about.html">
<p>About</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="../../privacy.html">
<p>Privacy Policy</p>
</a>
  </li>  
</ul>
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/viash-io/website/edit/main/guide/nextflow_vdsl3/principles.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/viash-io/website/blob/main/guide/nextflow_vdsl3/principles.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/viash-io/website/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>